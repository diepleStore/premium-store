!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="8a672c82-e5b6-4f3f-bb74-02c6d732539c",e._sentryDebugIdIdentifier="sentry-dbid-8a672c82-e5b6-4f3f-bb74-02c6d732539c")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3898],{8132:(e,t,n)=>{n.d(t,{A:()=>u});var a=n(80263),r=n(63320),l=n.n(r),o=n(25718),s=n(55335),i=n(16601),c=n(66933);let u=e=>{let{show:t,setShowUpgradePrompt:n}=e,r=(0,o.a)();return(0,a.jsxs)(s.A,{hideFooter:!0,visible:t,size:"medium",header:"Log retention",onCancel:()=>n(!1),"data-sentry-element":"Modal","data-sentry-component":"UpgradePrompt","data-sentry-source-file":"UpgradePrompt.tsx",children:[(0,a.jsx)(s.A.Content,{"data-sentry-element":"unknown","data-sentry-source-file":"UpgradePrompt.tsx",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("p",{className:"text-sm",children:"Logs can be retained up to a duration of 3 months depending on the plan that your project is on."}),(0,a.jsxs)("div",{className:"border-control bg-surface-300 rounded border",children:[(0,a.jsxs)("div",{className:"flex items-center px-4 pt-2 pb-1",children:[(0,a.jsx)("p",{className:"text-foreground-light w-[40%] text-sm",children:"Plan"}),(0,a.jsx)("p",{className:"text-foreground-light w-[60%] text-sm",children:"Retention duration"})]}),(0,a.jsxs)("div",{className:"py-1",children:[(0,a.jsxs)("div",{className:"flex items-center px-4 py-1",children:[(0,a.jsx)("p",{className:"w-[40%] text-sm",children:"Free"}),(0,a.jsx)("p",{className:"w-[60%] text-sm",children:c.rU.FREE.text})]}),(0,a.jsxs)("div",{className:"flex items-center px-4 py-1",children:[(0,a.jsx)("p",{className:"w-[40%] text-sm",children:"Pro"}),(0,a.jsx)("p",{className:"w-[60%] text-sm",children:c.rU.PRO.text})]}),(0,a.jsxs)("div",{className:"flex items-center px-4 py-1",children:[(0,a.jsx)("p",{className:"w-[40%] text-sm",children:"Team"}),(0,a.jsx)("p",{className:"w-[60%] text-sm",children:c.rU.TEAM.text})]}),(0,a.jsxs)("div",{className:"flex items-center px-4 py-1",children:[(0,a.jsx)("p",{className:"w-[40%] text-sm",children:"Enterprise"}),(0,a.jsx)("p",{className:"w-[60%] text-sm",children:c.rU.ENTERPRISE.text})]})]})]})]})}),(0,a.jsx)(s.A.Separator,{"data-sentry-element":"unknown","data-sentry-source-file":"UpgradePrompt.tsx"}),(0,a.jsxs)(s.A.Content,{className:"flex justify-end gap-3","data-sentry-element":"unknown","data-sentry-source-file":"UpgradePrompt.tsx",children:[(0,a.jsx)(i.$,{type:"default",onClick:()=>n(!1),"data-sentry-element":"Button","data-sentry-source-file":"UpgradePrompt.tsx",children:"Close"}),(0,a.jsx)(i.$,{asChild:!0,size:"tiny","data-sentry-element":"Button","data-sentry-source-file":"UpgradePrompt.tsx",children:(0,a.jsx)(l(),{href:"/org/".concat(null==r?void 0:r.slug,"/billing?panel=subscriptionPlan&source=logsRetentionUpgradePrompt"),"data-sentry-element":"Link","data-sentry-source-file":"UpgradePrompt.tsx",children:"Upgrade"})})]})]})}},21355:(e,t,n)=>{n.d(t,{A:()=>h});var a=n(17702),r=n(56947),l=n(53434),o=n.n(l),s=n(53239),i=n(66933),c=n(92589),u=n(3807),d=n(66001),p=n(81028);let m=(e,t)=>(0,s.useMemo)(()=>0!==e.length&&(0,c.l8)(e[0][t])?null==e?void 0:e.map(e=>(e[t]=(0,c.RT)(e[t]),e)):e,[JSON.stringify(e)]),h=function(e){var t,n,l,h,f;let{projectRef:g,table:x,filterOverride:y,limit:v}=e,j=(0,i.Et)(i.Z8),[b,w]=(0,s.useState)(new Date().toISOString()),{timestampStart:N,timestampEnd:C,filters:S,search:k}=(0,d.B)(),O=(0,s.useMemo)(()=>N||j.calcFrom(),[N,j]),_=(0,s.useMemo)(()=>C||j.calcTo(),[C,j]),F=(0,s.useMemo)(()=>({...S,...y,...k?{search_query:k}:{}}),[JSON.stringify(S),JSON.stringify(y),k]),P=(0,s.useMemo)(()=>({project:g,iso_timestamp_start:O,iso_timestamp_end:_,sql:(0,c.qr)(x,F,v)}),[g,O,_,x,F,v]),I=(0,s.useMemo)(()=>["projects",g,"logs",P],[g,P]),{data:L,isSuccess:A,isLoading:E,isRefetching:D,error:M,fetchNextPage:R,isFetchingNextPage:B,refetch:T}=(0,a.q)(I,async e=>{let{signal:t,pageParam:n}=e,{data:a,error:r}=await (0,u.Jt)("/platform/projects/{ref}/analytics/endpoints/logs.all",{params:{path:{ref:g},query:{...P,iso_timestamp_end:n||P.iso_timestamp_end}},signal:t});if(r)throw r;return a},{refetchOnWindowFocus:!1,getNextPageParam(e){var t,n;if((null!=(n=null==(t=e.result)?void 0:t.length)?n:0)===0)return;let a=e.result.length,{timestamp:r}=e.result[a-1];return o().utc(Number(r/1e3)).toISOString()}}),{logData:U,error:q,oldestTimestamp:W}=(0,s.useMemo)(()=>{var e,t;let n=[],a=M?M.message:null;null==L||null==(e=L.pages)||e.forEach(e=>{(null==e?void 0:e.result)&&(n=[...n,...e.result]),!a&&(null==e?void 0:e.error)&&(a=e.error)});let r=n.length>0?null==(t=n[n.length-1])?void 0:t.timestamp:void 0;return{logData:n,error:a,oldestTimestamp:r}},[null==L?void 0:L.pages]),G=(0,s.useMemo)(()=>(0,c.oZ)(x,F),[x,F]),$=(0,s.useMemo)(()=>["projects",g,"logs-count",{projectRef:g,sql:G,iso_timestamp_start:b,iso_timestamp_end:_,table:x,mergedFilters:F}],[g,G,b,_,x,F]),{data:z}=(0,r.I)($,async e=>{let{signal:t}=e,{data:n,error:a}=await (0,u.Jt)("/platform/projects/{ref}/analytics/endpoints/logs.all",{params:{path:{ref:g},query:{project:g,sql:G,iso_timestamp_start:b,iso_timestamp_end:_}},signal:t});if(a)throw a;return n},{refetchOnWindowFocus:!1,refetchInterval:6e4,enabled:!q&&!!L&&(null==L||null==(t=L.pages)?void 0:t.length)>0}),V=null!=(h=null==z||null==(l=z.result)||null==(n=l[0])?void 0:n.count)?h:0,H=(0,s.useMemo)(()=>(0,c.tS)(x,P,F),[x,P,F]),J=(0,s.useMemo)(()=>["projects",g,"logs-chart",{projectRef:g,sql:H,iso_timestamp_start:O,iso_timestamp_end:_}],[g,H,O,_]),{data:K,refetch:Y}=(0,r.I)(J,async e=>{let{signal:t}=e,{data:n,error:a}=await (0,u.Jt)("/platform/projects/{ref}/analytics/endpoints/logs.all",{params:{path:{ref:g},query:{iso_timestamp_start:O,iso_timestamp_end:_,project:g,sql:H}},signal:t});if(a)throw a;return n},{refetchOnWindowFocus:!1}),Z=(0,s.useCallback)(async()=>{w(new Date().toISOString()),Y(),T()},[T,Y]),X=m(null!=(f=null==K?void 0:K.result)?f:[],"timestamp"),{data:Q,error:ee}=(0,p.m)(X,"timestamp","count",0,O,_||new Date().toISOString());return{newCount:V,logData:U,isSuccess:A,isLoading:E||D,isLoadingOlder:B,error:q||ee,filters:F,params:P,oldestTimestamp:W?String(W):void 0,eventChartData:Q,refresh:Z,loadOlder:()=>R()}}},49730:(e,t,n)=>{n.d(t,{z:()=>i});var a=n(56947),r=n(3807),l=n(58897),o=n(62301);async function s(e,t){let{projectRef:n}=e;if(!n)throw Error("Project ref is required");let{data:a,error:l}=await (0,r.Jt)("/platform/projects/{ref}/load-balancers",{params:{path:{ref:n}},signal:t});return l&&(0,r.H4)(l),a}let i=function(e){let{projectRef:t}=e,{enabled:n=!0,...r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.I)(o.p.loadBalancers(t),e=>{let{signal:n}=e;return s({projectRef:t},n)},{enabled:n&&void 0!==t&&l.pe,...r})}},67833:(e,t,n)=>{n.d(t,{g:()=>o});var a=n(92589),r=n(53239),l=n(25718);let o=e=>{var t;let n=(0,l.a)(),[o,s]=(0,r.useState)(!1),i=(0,a.eu)(e,null==n||null==(t=n.plan)?void 0:t.id);return(0,r.useEffect)(()=>{i&&s(!0)},[e]),{showUpgradePrompt:o,setShowUpgradePrompt:s,shouldShowUpgradePrompt:i}}},81028:(e,t,n)=>{n.d(t,{m:()=>l});var a=n(92589),r=n(53239);let l=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,r.useMemo)(()=>{var e;let[n,r]=t;if(!(null==(e=n[0])?void 0:e[r]))return{data:n,error:void 0,isError:!1};try{return{data:(0,a.mu)(...t).sort((e,n)=>new Date(e[t[1]])-new Date(n[t[1]])),error:void 0,isError:!1}}catch(e){return{data:[],error:e,isError:!0}}},[JSON.stringify(t[0]),...t])}},83898:(e,t,n)=>{n.d(t,{A:()=>eb});var a=n(80263),r=n(53434),l=n.n(r),o=n(64081),s=n(52385),i=n(53239),c=n(89044),u=n(65842),d=n(23278),p=n(94786),m=n(40435),h=n(71547),f=n(84238),g=n(63320),x=n.n(g),y=n(79319),v=n(37518),j=n(90720),b=n(49730),w=n(58897),N=n(2),C=n(71171),S=n(3732),k=n(16601),O=n(38784),_=n(66933),F=n(10738),P=n(27863),I=n(44728);let L=e=>{let{options:t,filters:n,onFiltersChange:r,buttonClassName:l,align:o="start",isLoading:s=!1}=e,c=t.key,[u,d]=(0,i.useState)(!1),[p,m]=(0,i.useState)(n),h=()=>d(!u),f=(0,i.useMemo)(()=>{let e=p[c];return!!("object"==typeof e&&Object.values(e).some(Boolean))},[p,c]);return(0,i.useEffect)(()=>{u||m(n)},[u,n]),(0,a.jsxs)(F.AM,{open:u,onOpenChange:h,"data-sentry-element":"Popover","data-sentry-component":"LogsFilterPopover","data-sentry-source-file":"LogsFilterPopover.tsx",children:[(0,a.jsx)(F.Wv,{asChild:!0,"data-sentry-element":"PopoverTrigger","data-sentry-source-file":"LogsFilterPopover.tsx",children:(0,a.jsx)(k.$,{type:f?"default":"outline",onClick:h,className:(0,N.cn)("min-w-20 border-dashed",{"border-solid":f},l),"data-sentry-element":"Button","data-sentry-source-file":"LogsFilterPopover.tsx",children:(0,a.jsx)("span",{children:t.label})})}),(0,a.jsx)(F.hl,{align:o,className:"p-0 w-60",portal:!0,"data-sentry-element":"PopoverContent","data-sentry-source-file":"LogsFilterPopover.tsx",children:(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),e.stopPropagation(),r(p),d(!1)},children:[t.options.map((e,n)=>{var r;return(0,a.jsxs)(P.J,{htmlFor:"".concat(t.key,".").concat(e.key),className:"flex items-start hover:bg-overlay-hover overflow-hidden p-2 m-1 rounded-sm gap-3 transition-all duration-150 ease-in-out",children:[(0,a.jsx)("div",{children:(0,a.jsx)(I.S,{value:t.key,id:"".concat(t.key,".").concat(e.key),checked:!!(null==p||null==(r=p[t.key])?void 0:r[e.key]),onCheckedChange:n=>{m({...p,[t.key]:{...p[t.key],[e.key]:n}})}})}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{children:e.label}),(0,a.jsx)("span",{className:"text-sm text-foreground-lighter",children:e.description})]})]},e.key)}),(0,a.jsxs)("div",{className:"flex items-center justify-end gap-2 border-t border-default p-2",children:[(0,a.jsx)(k.$,{size:"tiny",type:"default",onClick:()=>{m({[c]:{}}),r({...n,[c]:{}})},htmlType:"button","data-sentry-element":"Button","data-sentry-source-file":"LogsFilterPopover.tsx",children:"Clear"}),(0,a.jsx)(k.$,{loading:s,type:"primary",htmlType:"submit","data-sentry-element":"Button","data-sentry-source-file":"LogsFilterPopover.tsx",children:"Apply"})]})]})})]})},A=e=>{let{isLoading:t,newCount:n,onRefresh:r,onSearch:l=()=>{},defaultSearchValue:o="",onExploreClick:g,queryUrl:F,condensedLayout:P,isShowingEventChart:I,onToggleEventChart:A,csvData:E,onFiltersChange:D,filters:M,table:R,onSelectedDatabaseChange:B,className:T,selectedDatePickerValue:U,setSelectedDatePickerValue:q}=e,W=(0,s.useRouter)(),{ref:G}=(0,c.g)(),[$,z]=(0,i.useState)(""),V=W.pathname.split("/").pop(),{data:H}=(0,b.z)({projectRef:G}),J=w.pe&&_.o0.includes(W.pathname),K=$!==o,Y=e=>l("search-input-change",{query:e});return(0,i.useEffect)(()=>{$!==o&&z(o)},[o]),(0,a.jsxs)("div",{className:(0,N.cn)("flex w-full items-center justify-between",P?" p-3":"",T),"data-sentry-component":"PreviewFilterPanel","data-sentry-source-file":"PreviewFilterPanel.tsx",children:[(0,a.jsxs)("div",{className:"flex flex-row items-center gap-x-2",children:[(0,a.jsx)("form",{id:"log-panel-search",onSubmit:e=>{e.preventDefault(),Y($)},children:(0,a.jsx)(C.A,{className:"w-60",size:"tiny",placeholder:"Search events",onChange:e=>z(e.target.value),onBlur:e=>{z(e.target.value),Y(e.target.value)},icon:(0,a.jsx)("div",{className:"text-foreground-lighter",children:(0,a.jsx)(u.A,{size:14})}),value:$,actions:(0,a.jsxs)("div",{className:"flex items-center gap-x-1 mr-0.5",children:[K&&(0,a.jsx)(y.G,{icon:(0,a.jsx)("span",{children:"â†²"}),type:"text",className:"px-1 h-[20px]",onClick:()=>Y($),tooltip:{content:{side:"bottom",text:"Search for events"}}}),$.length>0&&(0,a.jsx)(y.G,{icon:(0,a.jsx)(d.A,{}),type:"text",className:"p-[1px] h-[20px]",onClick:()=>Y(""),tooltip:{content:{side:"bottom",text:"Clear search"}}})]}),"data-sentry-element":"Input","data-sentry-source-file":"PreviewFilterPanel.tsx"})}),(0,a.jsxs)(S.m_,{"data-sentry-element":"Tooltip","data-sentry-source-file":"PreviewFilterPanel.tsx",children:[(0,a.jsx)(S.k$,{asChild:!0,"data-sentry-element":"TooltipTrigger","data-sentry-source-file":"PreviewFilterPanel.tsx",children:(0,a.jsx)(k.$,{title:"refresh",type:"default",className:"px-1.5",icon:(0,a.jsxs)("div",{className:"relative",children:[n>0&&(0,a.jsxs)("div",{className:"absolute -top-3 right-3 flex items-center justify-center",children:[(0,a.jsx)("div",{className:"absolute z-20",children:(0,a.jsx)("p",{style:{fontSize:"0.6rem"},className:"text-white",children:n>1e3?"".concat(Math.floor(n/100)/10,"K"):n})}),(0,a.jsx)("div",{className:"h-4 w-4 animate-ping rounded-full bg-green-800 opacity-60"}),(0,a.jsx)("div",{className:"z-60 absolute top-0 right-0 h-full w-full rounded-full bg-green-900 opacity-80"})]}),(0,a.jsx)(p.A,{})]}),loading:t,disabled:t,onClick:r,"data-sentry-element":"Button","data-sentry-source-file":"PreviewFilterPanel.tsx"})}),(0,a.jsx)(S.ZI,{side:"bottom",className:"text-xs","data-sentry-element":"TooltipContent","data-sentry-source-file":"PreviewFilterPanel.tsx",children:"Refresh logs"})]}),(0,a.jsx)(O.O,{helpers:_.Z8,onSubmit:e=>{l("datepicker-change",{to:e.to,from:e.from}),q(e)},value:U,"data-sentry-element":"LogsDatePicker","data-sentry-source-file":"PreviewFilterPanel.tsx"}),void 0!==_.W7[R]&&(0,a.jsx)("div",{className:"flex items-center",children:_.W7[R]&&Object.values(_.W7[R]).map((e,t)=>{let n=[];Object.values(_.W7[R]).length>=2&&(0===t?n.push("rounded-tr-none rounded-br-none"):t===Object.values(_.W7[R]).length-1?n.push("rounded-tl-none rounded-bl-none"):n.push("rounded-none"));let r=Object.values(_.W7[R]).length-1;return(0,a.jsx)(L,{buttonClassName:n.join(" "),options:e,onFiltersChange:D,filters:M,align:0===t?"start":t===r?"end":"center"},"".concat(e.key,"-filter"))})}),(0,a.jsx)("div",{className:"flex items-center space-x-2",children:(0,a.jsx)(k.$,{type:"default",onClick:()=>A(),icon:I?(0,a.jsx)(m.A,{}):(0,a.jsx)(h.A,{}),"data-sentry-element":"Button","data-sentry-source-file":"PreviewFilterPanel.tsx",children:"Chart"})}),!!E&&(0,a.jsx)(j.b,{iconOnly:!0,type:"default",align:"center",results:null!=E?E:[],fileName:"supabase-".concat(V,"-").concat(G,".csv")})]}),J?(0,a.jsxs)("div",{className:"flex items-center justify-center gap-x-2",children:[(0,a.jsxs)(S.m_,{children:[(0,a.jsx)(S.k$,{asChild:!0,children:(0,a.jsx)(k.$,{asChild:!0,className:"px-1.5",type:"default",icon:(0,a.jsx)(f.A,{}),children:(0,a.jsx)(x(),{href:F})})}),(0,a.jsx)(S.ZI,{side:"bottom",className:"text-xs",children:"Open query in Logs Explorer"})]}),(0,a.jsx)(v.A,{onSelectId:B,additionalOptions:R===_.le.EDGE&&(null!=H?H:[]).length>0?[{id:"".concat(G,"-all"),name:"API Load Balancer"}]:[]})]}):(0,a.jsx)(k.$,{asChild:!0,type:"default",onClick:g,children:(0,a.jsx)(x(),{href:F,children:"Explore via query"})})]})};var E=n(62761),D=n(17457),M=n(71433),R=n(21355),B=n(66001),T=n(31301),U=n(56947),q=n(92589),W=n(3807);let G=function(e){let{projectRef:t,id:n,queryType:a,paramsToMerge:r}=e,l=a?_.eV[a]:void 0,o=n&&l?(0,q.re)(l,n):"",s={...r,project:t,sql:o},i="warehouse"===a,c=!!(n&&l&&!i),{data:u,error:d,isLoading:p,isRefetching:m,refetch:h}=(0,U.I)(["projects",t,"single-log",n,a],async e=>{let{signal:n}=e,{data:a,error:r}=await (0,W.Jt)("/platform/projects/{ref}/analytics/endpoints/logs.all",{params:{path:{ref:t},query:s},signal:n});if(r)throw r;return a},{enabled:c,refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1}),f=d?d.message:null;return{data:(null==u?void 0:u.result)?u.result[0]:void 0,isLoading:c&&p||m,error:f,refresh:()=>h()}};var $=n(25718),z=n(67833),V=n(33887),H=n(99212),J=n(42417),K=n(53190),Y=n(67435),Z=n(15618),X=n(2513);let Q={AXIS:"hsl(var(--background-overlay-hover))",GREEN_1:"hsl(var(--brand-default))",GREEN_2:"hsl(var(--brand-500))",RED_1:"hsl(var(--destructive-default))",RED_2:"hsl(var(--destructive-500))",YELLOW_1:"hsl(var(--warning-default))",YELLOW_2:"hsl(var(--warning-500))"},ee=e=>{var t;let{data:n,onBarClick:r,EmptyState:o,DateTimeFormat:s="MMM D, YYYY, hh:mma"}=e,[c,u]=(0,i.useState)(null);if(0===n.length)return o||null;let d=l()(n[0].timestamp).format(s),p=l()(null==(t=n[(null==n?void 0:n.length)-1])?void 0:t.timestamp).format(s);return(0,a.jsxs)("div",{"data-testid":"logs-bar-chart",className:(0,N.cn)("flex flex-col gap-y-3"),"data-sentry-component":"LogsBarChart","data-sentry-source-file":"index.tsx",children:[(0,a.jsx)(X.at,{config:{error_count:{label:"Errors"},ok_count:{label:"Ok"},warning_count:{label:"Warnings"}},className:"h-[80px]","data-sentry-element":"ChartContainer","data-sentry-source-file":"index.tsx",children:(0,a.jsxs)(H.E,{data:n,onMouseMove:e=>{e.activeTooltipIndex!==c&&u(e.activeTooltipIndex)},onMouseLeave:()=>u(null),onClick:e=>{var t,n;let a=null==e||null==(n=e.activePayload)||null==(t=n[0])?void 0:t.payload;r&&r(a,e)},"data-sentry-element":"RechartBarChart","data-sentry-source-file":"index.tsx",children:[(0,a.jsx)(J.h,{tick:!1,width:0,axisLine:{stroke:Q.AXIS},tickLine:{stroke:Q.AXIS},"data-sentry-element":"YAxis","data-sentry-source-file":"index.tsx"}),(0,a.jsx)(K.W,{dataKey:"timestamp",interval:n.length-2,tick:!1,axisLine:{stroke:Q.AXIS},tickLine:{stroke:Q.AXIS},"data-sentry-element":"XAxis","data-sentry-source-file":"index.tsx"}),(0,a.jsx)(X.II,{content:(0,a.jsx)(X.Nt,{className:"text-foreground-light -mt-5",labelFormatter:e=>l()(e).format(s)}),"data-sentry-element":"ChartTooltip","data-sentry-source-file":"index.tsx"}),(0,a.jsx)(Y.y,{dataKey:"error_count",fill:Q.RED_1,maxBarSize:24,stackId:"stack","data-sentry-element":"Bar","data-sentry-source-file":"index.tsx",children:null==n?void 0:n.map((e,t)=>(0,a.jsx)(Z.f,{className:"cursor-pointer transition-colors",fill:c===t||null===c?Q.RED_1:Q.RED_2},"error-".concat(t)))}),(0,a.jsx)(Y.y,{dataKey:"warning_count",fill:Q.YELLOW_1,maxBarSize:24,stackId:"stack","data-sentry-element":"Bar","data-sentry-source-file":"index.tsx",children:null==n?void 0:n.map((e,t)=>(0,a.jsx)(Z.f,{className:"cursor-pointer transition-colors",fill:c===t||null===c?Q.YELLOW_1:Q.YELLOW_2},"warning-".concat(t)))}),(0,a.jsx)(Y.y,{dataKey:"ok_count",fill:Q.GREEN_1,maxBarSize:24,stackId:"stack","data-sentry-element":"Bar","data-sentry-source-file":"index.tsx",children:null==n?void 0:n.map((e,t)=>(0,a.jsx)(Z.f,{className:"cursor-pointer transition-colors",fill:c===t||null===c?Q.GREEN_1:Q.GREEN_2},"success-".concat(t)))})]})}),n&&(0,a.jsxs)("div",{className:"text-foreground-lighter -mt-10 flex items-center justify-between text-[10px] font-mono",children:[(0,a.jsx)("span",{children:d}),(0,a.jsx)("span",{children:p})]})]})};var et=n(50447),en=n(8132),ea=n(24726),er=n(48277),el=n(28894),eo=n(59872),es=n(1511);function ei(e){let{className:t,classNames:n,showOutsideDays:r=!0,...l}=e;return(0,a.jsx)(eo.hv,{showOutsideDays:r,className:(0,N.cn)("p-3",t),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,N.cn)((0,es.r)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-foreground-muted rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"text-center text-sm p-0 relative [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,N.cn)((0,es.r)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"text-foreground-muted opacity-50",day_disabled:"text-foreground-muted opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...n},components:{IconLeft:e=>{let{...t}=e;return(0,a.jsx)(er.A,{className:"h-4 w-4"})},IconRight:e=>{let{...t}=e;return(0,a.jsx)(el.A,{className:"h-4 w-4"})}},...l,"data-sentry-element":"DayPicker","data-sentry-component":"Calendar","data-sentry-source-file":"calendar.tsx"})}ei.displayName="Calendar";var ec=n(78081),eu=n(50854),ed=n(34587),ep=n(49189);function em(e){var t,n;let{condition:r,filterProperties:l,id:o,isActive:s,isOperatorActive:c,isLoading:u,onOperatorChange:d,onValueChange:p,onOperatorFocus:m,onValueFocus:h,onBlur:f,onLabelClick:g,onKeyDown:x}=e,y=(0,i.useRef)(null),v=(0,i.useRef)(null),j=l.find(e=>e.name===r.propertyName);return((0,i.useEffect)(()=>{s&&v.current?v.current.focus():c&&y.current&&y.current.focus()},[s,c]),j)?(0,a.jsxs)("div",{className:"flex items-center rounded px-2 h-6 bg-surface-400","data-sentry-component":"FilterCondition","data-sentry-source-file":"FilterCondition.tsx",children:[(0,a.jsx)("span",{className:"text-xs font-medium mr-1 font-mono cursor-pointer",onClick:g,children:j.label}),(0,a.jsx)(ep.p,{ref:y,value:r.operator,onChange:e=>d(e.target.value),onFocus:m,onBlur:f,className:"border-none bg-transparent p-0 text-xs focus:outline-none focus:ring-0 focus:shadow-none focus-visible:ring-0 focus-visible:ring-offset-0 font-mono h-6 mr-1 text-foreground-light",style:{width:"".concat(Math.max(r.operator.length,1),"ch"),minWidth:"1ch"},disabled:u,"aria-label":"Operator for ".concat(j.label),"data-sentry-element":"Input_Shadcn_","data-sentry-source-file":"FilterCondition.tsx"}),(0,a.jsx)(ep.p,{ref:v,value:(null==(t=r.value)?void 0:t.toString())||"",onChange:e=>p(e.target.value),onFocus:h,onBlur:f,onKeyDown:x,className:"border-none bg-transparent p-0 text-xs focus:outline-none focus:ring-0 focus:shadow-none focus-visible:ring-0 focus-visible:ring-offset-0 font-mono h-6",style:{width:"".concat(Math.max((null==(n=r.value)?void 0:n.toString().length)||0,1),"ch"),minWidth:"1ch"},disabled:u,"aria-label":"Value for ".concat(j.label),"data-sentry-element":"Input_Shadcn_","data-sentry-source-file":"FilterCondition.tsx"})]}):null}function eh(e){let{group:t,path:n,isLoading:r,activeInput:l,filterProperties:o,onOperatorChange:s,onValueChange:c,onOperatorFocus:u,onValueFocus:d,onBlur:p,onLabelClick:m,onKeyDown:h,onGroupFreeformChange:f,onGroupFreeformFocus:g,groupFreeformValue:x,isGroupFreeformActive:y,onLogicalOperatorChange:v}=e,[j,b]=(0,i.useState)(""),w=(0,i.useRef)(null),[N,C]=(0,i.useState)(!1),S=y&&(null==l?void 0:l.type)==="group"&&n.length===l.path.length&&n.every((e,t)=>e===l.path[t]);(0,i.useEffect)(()=>{""===x&&b("")},[x]),(0,i.useEffect)(()=>{S&&w.current&&w.current.focus()},[S]);let k=()=>{null==v||v(n)},O=()=>{C(!0)},_=()=>{C(!1)},F=e=>!!l&&"value"===l.type&&e.length===l.path.length&&e.every((e,t)=>e===l.path[t]),P=e=>!!l&&"operator"===l.type&&e.length===l.path.length&&e.every((e,t)=>e===l.path[t]);return(0,a.jsx)("div",{className:"flex items-center gap-1 rounded ".concat(n.length>0?"before:content-['('] before:text-foreground-muted after:content-[')'] after:text-foreground-muted":""),"data-sentry-component":"FilterGroup","data-sentry-source-file":"FilterGroup.tsx",children:(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[t.conditions.map((e,j)=>{let b=[...n,j];return(0,a.jsxs)(i.Fragment,{children:[j>0&&(0,a.jsx)("span",{className:"text-xs font-medium cursor-pointer ".concat(N?"bg-surface-400 text-foreground dark:bg-surface-400":"text-foreground-muted"),onClick:k,onMouseEnter:O,onMouseLeave:_,children:t.logicalOperator}),"logicalOperator"in e?(0,a.jsx)(eh,{filterProperties:o,group:e,path:b,isLoading:r,activeInput:l,onOperatorChange:s,onValueChange:c,onOperatorFocus:u,onValueFocus:d,onBlur:p,onLabelClick:m,onKeyDown:h,onGroupFreeformChange:f,onGroupFreeformFocus:g,groupFreeformValue:x,isGroupFreeformActive:y,onLogicalOperatorChange:v}):(0,a.jsx)(em,{id:"filter-".concat(b.join("-")),condition:e,isActive:F(b),isOperatorActive:P(b),isLoading:r,onOperatorChange:e=>s(b,e),filterProperties:o,onValueChange:e=>c(b,e),onOperatorFocus:()=>u(b),onValueFocus:()=>d(b),onBlur:p,onLabelClick:()=>m(b),onKeyDown:h})]},j)}),(0,a.jsx)(ep.p,{ref:w,value:S?x:j,onChange:e=>{b(e.target.value),f(n,e.target.value)},onFocus:()=>g(n),onBlur:p,onKeyDown:h,className:"border-none bg-transparent p-0 text-xs focus:outline-none focus:ring-0 focus:shadow-none focus-visible:ring-0 focus-visible:ring-offset-0 font-mono h-6",placeholder:0===n.length&&0===t.conditions.length?"Search or filter...":"+",disabled:r,style:{width:"".concat(Math.max((S?x:j).length||1,0===n.length&&0===t.conditions.length?18:1),"ch"),minWidth:0===n.length&&0===t.conditions.length?"18ch":"1ch"},"data-sentry-element":"Input_Shadcn_","data-sentry-source-file":"FilterGroup.tsx"})]})})}function ef(e){return"object"==typeof e&&"component"in e}function eg(e){return"object"==typeof e&&"value"in e&&"label"in e}function ex(e){return"logicalOperator"in e}function ey(e){let{filterProperties:t,filters:n,onFilterChange:r,freeformText:l,onFreeformTextChange:o,aiApiUrl:s}=e,[c,d]=(0,i.useState)(!1),[p,m]=(0,i.useState)(null),h=(0,i.useRef)(null),[f,g]=(0,i.useState)(0),[x,y]=(0,i.useState)(!1),v=(0,i.useRef)(null),[j,b]=(0,i.useState)(null),w=(0,i.useRef)([]),[N,C]=(0,i.useState)({}),[S,k]=(0,i.useState)({}),O=(0,i.useRef)(null),[_,F]=(0,i.useState)(null),[P,I]=(0,i.useState)(!1),[L,A]=(0,i.useState)(null),E=(e,t)=>{if(0===t.length)return e;let[n,...a]=t,r=e.conditions[n];return r?0===a.length?ex(r)?r:null:ex(r)?E(r,a):null:null},D=(e,t)=>{if(0===t.length)return null;let[n,...a]=t,r=e.conditions[n];return r?0===a.length?ex(r)?null:r:ex(r)?D(r,a):null:null},M=(0,i.useCallback)((e,t)=>{console.log("handleInputChange called with path:",e,"value:",t);let a=(e,t,n)=>{if(1===t.length)return console.log("Updating value at path level 1:",t[0],"newValue:",n),{...e,conditions:e.conditions.map((e,a)=>a===t[0]?{...e,value:n}:e)};let[r,...l]=t;return console.log("Updating nested value at path:",r,"remaining path:",l),{...e,conditions:e.conditions.map((e,t)=>t===r&&ex(e)?a(e,l,n):e)}},l=a(n,e,t);console.log("Updated filters:",l),r(l),g(0),y(!0)},[n]),R=(0,i.useCallback)((e,t)=>{let a=(e,t,n)=>{if(1===t.length)return{...e,conditions:e.conditions.map((e,a)=>a===t[0]?{...e,operator:n}:e)};let[r,...l]=t;return{...e,conditions:e.conditions.map((e,t)=>t===r&&ex(e)?a(e,l,n):e)}};r(a(n,e,t)),g(0),y(!0)},[n]),B=(0,i.useCallback)(e=>{b({type:"value",path:e}),y(!0),v.current&&clearTimeout(v.current)},[]),T=(0,i.useCallback)(e=>{b({type:"operator",path:e}),y(!0),v.current&&clearTimeout(v.current)},[]),U=(0,i.useCallback)(e=>{b({type:"group",path:e}),y(!0),v.current&&clearTimeout(v.current)},[]),q=(0,i.useCallback)(()=>{v.current&&clearTimeout(v.current),v.current=setTimeout(()=>{y(!1),b(null)},150)},[]),W=async()=>{if(j&&"group"===j.type&&s){d(!0),m(null);try{let e=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:l,filterProperties:t,currentPath:j.path})});if(!e.ok){let t=await e.json();throw Error(t.error||"AI filtering failed")}let a=await e.json();if(console.log(a),!a||!Array.isArray(a.conditions))throw Error("Invalid response from AI filter");let i=e=>e.map(e=>{if(ex(e))return{logicalOperator:e.logicalOperator,conditions:i(e.conditions)};{let n=t.find(t=>t.name===e.propertyName);if(!n)throw Error("Invalid property: ".concat(e.propertyName));return{propertyName:n.name,value:e.value,operator:e.operator||"="}}}),c={logicalOperator:a.logicalOperator||"AND",conditions:i(a.conditions)},u=(e,t,n)=>{if(0===t.length)return n;let[a,...r]=t;return{...e,conditions:e.conditions.map((e,t)=>t===a?u(e,r,n):e)}},d=u(n,j.path,c);r(d),o(""),y(!1)}catch(e){console.error("Error in AI filtering:",e),m(e.message||"AI filtering failed. Please try again."),o("")}finally{d(!1)}}},G=(0,i.useCallback)((e,t)=>{o(t),g(0),y(!0)},[]),$=(0,i.useCallback)((e,t,n)=>{if(0===t.length)return{...e,conditions:[...e.conditions,{propertyName:n.name,value:null,operator:"="}]};let[a,...r]=t;return{...e,conditions:e.conditions.map((e,t)=>t===a?$(e,r,n):e)}},[]),z=(0,i.useCallback)((e,t)=>{if(0===t.length)return{...e,conditions:[...e.conditions,{logicalOperator:"AND",conditions:[]}]};let[n,...a]=t;return{...e,conditions:e.conditions.map((e,t)=>t===n?z(e,a):e)}},[]);(0,i.useCallback)((e,t)=>{if(e.options&&ef(e.options)){let n=e.options.component({onChange:e=>{M(t,e),I(!1),F(null),A(null)},onCancel:()=>{I(!1),F(null),A(null)},search:l});F(n),I(!0),A(t)}},[M,l]);let V=(e,t,n)=>{if(1===t.length)return{...e,conditions:e.conditions.map((e,a)=>a===t[0]?n(e):e)};let[a,...r]=t;return{...e,conditions:e.conditions.map((e,t)=>t===a&&ex(e)?V(e,r,n):e)}},H=e=>{if("ai-filter"===e)return void W();if("group"===e){if(j&&"group"===j.type){let e=j.path,t=E(n,e);if(!t)return;r(z(n,e)),w.current=[...e,t.conditions.length],setTimeout(()=>{b({type:"group",path:w.current}),y(!0)},0),o("")}return}if(j&&"value"===j.type){let t=j.path,n=K.find(t=>t.value===e);if((null==n?void 0:n.isCustom)&&n.customOption){let e=n.customOption({onChange:e=>{console.log("onChange:",t,e),M(t,e),I(!1),F(null),A(null),setTimeout(()=>{b({type:"group",path:t.slice(0,-1)}),y(!0)},0)},onCancel:()=>{I(!1),F(null),A(null),setTimeout(()=>{b({type:"group",path:t.slice(0,-1)}),y(!0)},0)},search:l});F(e),I(!0),A(t)}else M(t,e),setTimeout(()=>{b({type:"group",path:t.slice(0,-1)}),y(!0)},0)}else if(j&&"operator"===j.type)R(j.path,e),b(null);else if(j&&"group"===j.type){let a=t.find(t=>t.name===e);if(a){let e=j.path,t=E(n,e);if(!t)return;if(a.options&&!Array.isArray(a.options)&&ef(a.options)){let l=$(n,e,a);r(l);let o=[...e,t.conditions.length],s=a.options.component({onChange:t=>{console.log("Custom component onChange called with value:",t),console.log("Current active input path:",o),r(V(l,o,e=>({...e,propertyName:a.name,value:t,operator:"="}))),I(!1),F(null),A(null),b({type:"group",path:e})},onCancel:()=>{console.log("Custom component onCancel called"),Y(o),I(!1),F(null),A(null),b({type:"group",path:e})},search:""});F(s),I(!0),A(o),y(!1)}else{r($(n,e,a));let l=[...e,t.conditions.length];setTimeout(()=>{b({type:"value",path:l}),y(!0)},0)}o("")}else m("Invalid property: ".concat(e))}},J=(0,i.useCallback)(async function(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!e.options||Array.isArray(e.options)||!(!(!(t=e.options)||Array.isArray(t)||ef(t))&&"function"==typeof t&&"AsyncFunction"===t.constructor.name))return;let a=S[e.name];a&&a.searchValue===n||(O.current&&clearTimeout(O.current),O.current=setTimeout(async()=>{if(!N[e.name])try{C(t=>({...t,[e.name]:!0}));let t=e.options,a=(await t(n)).map(e=>"string"==typeof e?{label:e,value:e}:e);k(t=>({...t,[e.name]:{options:a,searchValue:n}}))}catch(t){console.error("Error loading options for ".concat(e.name,":"),t),m("Failed to load options for ".concat(e.label))}finally{C(t=>({...t,[e.name]:!1}))}},300))},[N,S]);(0,i.useEffect)(()=>()=>{O.current&&clearTimeout(O.current)},[]);let K=(0,i.useMemo)(()=>{var e,r,o;if((null==j?void 0:j.type)==="operator"){let e=D(n,j.path),a=t.find(t=>t.name===(null==e?void 0:e.propertyName)),r=(null==e||null==(o=e.operator)?void 0:o.toUpperCase())||"";return((null==a?void 0:a.operators)||["="]).filter(e=>e.toUpperCase().includes(r)).map(e=>({value:e,label:e,icon:void 0}))}let i=(null==j?void 0:j.type)==="group"?l:(null==j?void 0:j.type)==="value"&&(null==(r=D(n,j.path))||null==(e=r.value)?void 0:e.toString())||"",c=[];if((null==j?void 0:j.type)==="group")c.push(...t.filter(e=>e.label.toLowerCase().includes(i.toLowerCase())).map(e=>({value:e.name,label:e.label,icon:void 0,isCustom:!1}))),c.push({value:"group",label:"New Group",icon:void 0}),i.trim().length>0&&s&&c.push({value:"ai-filter",label:"Filter by AI",icon:(0,a.jsx)(ec.A,{className:"mr-2 h-4 w-4",strokeWidth:1.25})});else if((null==j?void 0:j.type)==="value"){let e=D(n,j.path),a=t.find(t=>t.name===(null==e?void 0:e.propertyName));a&&(!Array.isArray(a.options)&&ef(a.options)?c.push({value:"custom",label:a.options.label||"Custom...",icon:void 0,isCustom:!0,customOption:a.options.component}):N[a.name]?c.push({value:"loading",label:"Loading options...",icon:void 0}):Array.isArray(a.options)?c.push(...a.options.filter(e=>{if("string"==typeof e)return e.toLowerCase().includes(i.toLowerCase());if(eg(e))return e.label.toLowerCase().includes(i.toLowerCase());if(ef(e)){var t,n;return null==(n=null==(t=e.label)?void 0:t.toLowerCase().includes(i.toLowerCase()))||n}return!0}).map(e=>"string"==typeof e?{value:e,label:e,icon:void 0}:eg(e)?{value:e.value,label:e.label,icon:void 0}:ef(e)?{value:"custom",label:e.label||"Custom...",icon:void 0,isCustom:!0,customOption:e.component}:null).filter(e=>null!==e)):S[a.name]&&c.push(...S[a.name].options.map(e=>"string"==typeof e?{value:e,label:e,icon:void 0}:{value:e.value,label:e.label,icon:void 0})),"function"!=typeof a.options||N[a.name]||S[a.name]&&S[a.name].searchValue===i||J(a,i))}return c},[j,l,n,t,S,N,J,s]),Y=(0,i.useCallback)(e=>{let t=(e,n)=>{if(1===n.length)return{...e,conditions:e.conditions.filter((e,t)=>t!==n[0])};let[a,...r]=n;return{...e,conditions:e.conditions.map((e,n)=>n===a?t(e,r):e)}};r(t(n,e))},[n]),Z=(0,i.useCallback)(e=>{let t=(e,n)=>{if(1===n.length)return{...e,conditions:e.conditions.filter((e,t)=>t!==n[0])};let[a,...r]=n;return{...e,conditions:e.conditions.map((e,n)=>n===a?t(e,r):e)}};r(t(n,e))},[n]),X=(0,i.useCallback)(e=>{b({type:"value",path:e})},[]),Q=(0,i.useCallback)(e=>{let t=(e,n)=>{if(0===n.length)return{...e,logicalOperator:"AND"===e.logicalOperator?"OR":"AND"};let[a,...r]=n;return{...e,conditions:e.conditions.map((e,n)=>n===a&&ex(e)?t(e,r):e)}};r(t(n,e))},[n]);return(0,a.jsxs)("div",{className:"w-full space-y-2 relative","data-sentry-component":"FilterBar","data-sentry-source-file":"FilterBar.tsx",children:[(0,a.jsxs)("div",{className:"relative flex items-center w-full",children:[(0,a.jsx)(u.A,{className:"absolute left-1 top-1/2 transform -translate-y-1/2 text-foreground-muted w-4 h-4","data-sentry-element":"Search","data-sentry-source-file":"FilterBar.tsx"}),(0,a.jsx)("div",{className:"flex-1 flex flex-wrap items-center pl-6 pr-1 py-0 gap-1 h-full",children:(0,a.jsx)(eh,{group:n,filterProperties:t,path:[],isLoading:c,activeInput:j,onOperatorChange:R,onValueChange:M,onOperatorFocus:T,onValueFocus:B,onBlur:q,onLabelClick:X,onKeyDown:e=>{if("ArrowDown"===e.key)e.preventDefault(),g(e=>e<K.length-1?e+1:e);else if("ArrowUp"===e.key)e.preventDefault(),g(e=>e>0?e-1:0);else if("Enter"===e.key)e.preventDefault(),K[f]&&H(K[f].value);else if("Backspace"===e.key){if((null==j?void 0:j.type)==="operator")return;let t=""===e.target.value;if((null==j?void 0:j.type)==="group"&&t){e.preventDefault();let t=E(n,j.path);t&&t.conditions.length>0?(Y([...j.path,t.conditions.length-1]),b({type:"group",path:j.path})):t&&0===t.conditions.length&&(Z(j.path),j.path.length>0?b({type:"group",path:j.path.slice(0,-1)}):b(null))}else if((null==j?void 0:j.type)==="value"&&t){let t=D(n,j.path);t&&!t.value&&(e.preventDefault(),Y(j.path),b({type:"group",path:j.path.slice(0,-1)}))}}else if(" "===e.key&&(null==j?void 0:j.type)==="value")e.preventDefault(),b({type:"group",path:[]});else if("ArrowLeft"===e.key){if(0===e.target.selectionStart){if(e.preventDefault(),(null==j?void 0:j.type)==="value"){let e=j.path[j.path.length-1];e>0?b({type:"value",path:[...j.path.slice(0,-1),e-1]}):b({type:"operator",path:j.path})}else if((null==j?void 0:j.type)==="group"){let e=E(n,j.path);e&&e.conditions.length>0?b({type:"value",path:[...j.path,e.conditions.length-1]}):j.path.length>0&&b({type:"group",path:j.path.slice(0,-1)})}}}else if("ArrowRight"===e.key){let t=e.target;if(t.selectionStart===t.value.length)if(e.preventDefault(),(null==j?void 0:j.type)==="value"){let e=E(n,j.path.slice(0,-1)),t=j.path[j.path.length-1];e&&t<e.conditions.length-1?b({type:"value",path:[...j.path.slice(0,-1),t+1]}):b({type:"group",path:j.path.slice(0,-1)})}else(null==j?void 0:j.type)==="operator"&&b({type:"value",path:j.path})}else"Escape"===e.key&&(y(!1),b(null))},onGroupFreeformChange:G,onGroupFreeformFocus:U,groupFreeformValue:l,isGroupFreeformActive:(null==j?void 0:j.type)==="group",onLogicalOperatorChange:Q,"data-sentry-element":"FilterGroupComponent","data-sentry-source-file":"FilterBar.tsx"})})]}),p&&(0,a.jsx)("div",{className:"text-red-500 text-xs mt-1",children:p}),x&&!c&&null!==j&&K.length>0&&(0,a.jsx)(eu.uB,{ref:h,className:"absolute z-10 w-full h-auto shadow-md",children:(0,a.jsxs)(eu.oI,{children:[(0,a.jsx)(eu.xL,{children:"No results found."}),(0,a.jsx)(eu.L$,{children:K.map((e,t)=>(0,a.jsxs)(eu.h_,{onSelect:()=>H(e.value),className:"text-xs font-mono ".concat(t===f?"bg-surface-400":""),children:[e.icon,e.label]},e.value))})]})}),(0,a.jsx)(ed.lG,{open:P,onOpenChange:e=>I(e),"data-sentry-element":"Dialog","data-sentry-source-file":"FilterBar.tsx",children:(0,a.jsx)(ed.Cf,{hideClose:!0,className:"!w-fit max-w-screen","data-sentry-element":"DialogContent","data-sentry-source-file":"FilterBar.tsx",children:_})})]})}function ev(e){let{onChange:t,onCancel:n}=e,[r,o]=(0,i.useState)();return(0,a.jsxs)("div",{className:"w-full space-y-4","data-sentry-component":"CustomDateRangePicker","data-sentry-source-file":"PreviewFilterPanelWithUniversal.tsx",children:[(0,a.jsx)(ei,{initialFocus:!0,mode:"range",defaultMonth:null==r?void 0:r.from,selected:r,onSelect:o,numberOfMonths:2,"data-sentry-element":"Calendar","data-sentry-source-file":"PreviewFilterPanelWithUniversal.tsx"}),(0,a.jsxs)("div",{className:"flex justify-end gap-2 py-3 px-4 border-t",children:[(0,a.jsx)(k.$,{type:"default",onClick:n,"data-sentry-element":"Button","data-sentry-source-file":"PreviewFilterPanelWithUniversal.tsx",children:"Cancel"}),(0,a.jsx)(k.$,{type:"primary",onClick:()=>{if(null==r?void 0:r.from){let e=l()(r.from).toISOString(),n=r.to?l()(r.to).toISOString():l()().toISOString();t("".concat(e,"|").concat(n))}},"data-sentry-element":"Button","data-sentry-source-file":"PreviewFilterPanelWithUniversal.tsx",children:"Apply"})]})]})}let ej=e=>{let{isLoading:t,newCount:n,onRefresh:r,onSearch:o=()=>{},defaultSearchValue:u="",defaultFromValue:d,defaultToValue:g,onExploreClick:y,queryUrl:j,condensedLayout:C,isShowingEventChart:O,onToggleEventChart:F,csvData:P,onFiltersChange:I,filters:L,table:A,onSelectedDatabaseChange:E,className:D,selectedDatePickerValue:M,setSelectedDatePickerValue:R}=e,B=(0,s.useRouter)(),{ref:T}=(0,c.g)();B.pathname.split("/").pop();let{data:U}=(0,b.z)({projectRef:T}),q=w.pe&&_.o0.includes(B.pathname),W=(0,i.useMemo)(()=>{let e=_.W7[A];if(!e)return[];let t=[];return t.push({label:"Time Range",name:"timerange",type:"string",operators:["="],options:[{label:"Last 15 minutes",value:"".concat(l()().subtract(15,"minute").toISOString(),"|").concat(l()().toISOString())},{label:"Last 30 minutes",value:"".concat(l()().subtract(30,"minute").toISOString(),"|").concat(l()().toISOString())},{label:"Last hour",value:"".concat(l()().subtract(1,"hour").toISOString(),"|").concat(l()().toISOString())},{label:"Last 3 hours",value:"".concat(l()().subtract(3,"hour").toISOString(),"|").concat(l()().toISOString())},{label:"Last 24 hours",value:"".concat(l()().subtract(24,"hour").toISOString(),"|").concat(l()().toISOString())},{label:"Custom Range...",component:e=>(0,a.jsx)(ev,{...e})}]}),Object.entries(e).forEach(e=>{let[n,a]=e;t.push({label:a.label,name:a.key,type:"string",operators:["="],options:a.options.map(e=>({label:e.label,value:e.key,description:e.description}))})}),t},[A]),G=(0,i.useMemo)(()=>{let e=[];return(d||g)&&!L.timerange&&e.push({propertyName:"timerange",operator:"=",value:"".concat(d||"","|").concat(g||"")}),Object.entries(L).forEach(t=>{let[n,a]=t;if("search_query"!==n)if("object"==typeof a&&null!==a){if(0===Object.keys(a).length)return void e.push({propertyName:n,operator:"=",value:""});Object.entries(a).forEach(t=>{let[a,r]=t;r&&e.push({propertyName:n,operator:"=",value:a})})}else null!=a&&e.push({propertyName:n,operator:"=",value:String(a)})}),{logicalOperator:"AND",conditions:e}},[L,d,g]);return(0,a.jsx)("div",{className:(0,N.cn)("flex w-full flex-col gap-2",C?" p-3":"",D),"data-sentry-component":"PreviewFilterPanelWithUniversal","data-sentry-source-file":"PreviewFilterPanelWithUniversal.tsx",children:(0,a.jsxs)("div",{className:"flex items-center justify-between gap-x-2",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(ey,{filterProperties:W,filters:G,onFilterChange:e=>{let t={},n=!1;e.conditions.forEach(e=>{if(!("propertyName"in e))return;let a=e.propertyName;if(a)if("timerange"===a)if(n=!0,e.value){let n=String(e.value),[a,r]=n.split("|");t.timerange={[n]:!0},o("datepicker-change",{from:a,to:r})}else t.timerange={},o("datepicker-change",{from:"",to:""});else{if(t[a]||(t[a]={}),!e.value)return;t[a][e.value]=!0}}),n||o("datepicker-change",{from:"",to:""}),I(t)},freeformText:u,onFreeformTextChange:e=>o("search-input-change",{query:e}),"data-sentry-element":"FilterBar","data-sentry-source-file":"PreviewFilterPanelWithUniversal.tsx"})}),(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,a.jsx)(k.$,{title:"refresh",type:"default",className:"px-1.5",icon:(0,a.jsxs)("div",{className:"relative",children:[n>0&&(0,a.jsxs)("div",{className:"absolute -top-3 right-3 flex items-center justify-center",children:[(0,a.jsx)("div",{className:"absolute z-20",children:(0,a.jsx)("p",{style:{fontSize:"0.6rem"},className:"text-white",children:n>1e3?"".concat(Math.floor(n/100)/10,"K"):n})}),(0,a.jsx)("div",{className:"h-4 w-4 animate-ping rounded-full bg-green-800 opacity-60"}),(0,a.jsx)("div",{className:"z-60 absolute top-0 right-0 h-full w-full rounded-full bg-green-900 opacity-80"})]}),(0,a.jsx)(p.A,{})]}),loading:t,disabled:t,onClick:r,"data-sentry-element":"Button","data-sentry-source-file":"PreviewFilterPanelWithUniversal.tsx"}),(0,a.jsx)(k.$,{type:"default",onClick:()=>F(),icon:O?(0,a.jsx)(m.A,{}):(0,a.jsx)(h.A,{}),"data-sentry-element":"Button","data-sentry-source-file":"PreviewFilterPanelWithUniversal.tsx",children:"Chart"}),q?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(S.m_,{children:[(0,a.jsx)(S.k$,{asChild:!0,children:(0,a.jsx)(k.$,{asChild:!0,className:"px-1.5",type:"default",icon:(0,a.jsx)(f.A,{}),children:(0,a.jsx)(x(),{href:j})})}),(0,a.jsx)(S.ZI,{side:"bottom",className:"text-xs",children:"Open query in Logs Explorer"})]}),(0,a.jsx)(v.A,{onSelectId:E,additionalOptions:A===_.le.EDGE&&(null!=U?U:[]).length>0?[{id:"".concat(T,"-all"),name:"API Load Balancer"}]:[]})]}):(0,a.jsx)(k.$,{asChild:!0,type:"default",onClick:y,children:(0,a.jsx)(x(),{href:j,children:"Explore via query"})})]})]})})},eb=e=>{let{projectRef:t,queryType:n,filterOverride:r,condensedLayout:u=!1,tableName:d,children:p,EmptyState:m,filterPanelClassName:h}=e,f=(0,ea._)("universalFilterBar"),g=(0,s.useRouter)(),{db:x}=(0,c.g)(),y=(0,$.a)(),v=(0,V.RE)(),[j,b]=(0,i.useState)(!0),[w,N]=(0,i.useState)(function(){let e=g.query.iso_timestamp_start,t=g.query.iso_timestamp_end;if(e&&t)return{to:t,from:e,text:"".concat(l()(e).format("DD MMM, HH:mm")," - ").concat(l()(t).format("DD MMM, HH:mm")),isHelper:!1};let n=_.Z8.find(e=>e.default);return{to:n.calcTo(),from:n.calcFrom(),text:n.text,isHelper:!0}}()),{search:C,setSearch:S,timestampStart:O,timestampEnd:F,setTimeRange:P,filters:I,setFilters:L}=(0,B.B)();(0,i.useEffect)(()=>{O&&F&&N({to:F,from:O,text:"".concat(l()(O).format("DD MMM, HH:mm")," - ").concat(l()(F).format("DD MMM, HH:mm")),isHelper:!1})},[O,F]);let[U,W]=(0,T.t)(),{data:H,isSuccess:J}=(0,M.Vh)({projectRef:t}),K=d||_.eV[n],{error:Y,logData:Z,params:X,newCount:Q,isLoading:er,eventChartData:el,isLoadingOlder:eo,loadOlder:es,refresh:ei}=(0,R.A)({projectRef:t,table:K,filterOverride:r}),{data:ec,isLoading:eu,error:ed}=G({projectRef:t,id:null!=U?U:void 0,queryType:n,paramsToMerge:X}),{showUpgradePrompt:ep,setShowUpgradePrompt:em}=(0,z.g)(O),eh=async(e,t)=>{let{query:n,to:a,from:r}=t;if("search-input-change"===e)S(n||""),W(null);else if("event-chart-bar-click"===e)P(r||"",a||"");else if("datepicker-change"===e){var l;(0,q.eu)(r||"",null==y||null==(l=y.plan)?void 0:l.id)?em(!ep):P(r||"",a||"")}};(0,i.useEffect)(()=>{if(O){var e;(0,q.eu)(O,null==y||null==(e=y.plan)?void 0:e.id)&&em(!ep)}},[O,y]),(0,i.useEffect)(()=>{void 0!==x?void 0!==(null==H?void 0:H.find(e=>e.identifier===x))&&v.setSelectedDatabaseId(x):void 0!==v.selectedDatabaseId&&v.selectedDatabaseId!==t&&(_.o0.includes(g.pathname)?g.push({pathname:g.pathname,query:{...g.query,db:v.selectedDatabaseId}}):v.setSelectedDatabaseId(t))},[x,J]);let ef={className:h,csvData:Z,isLoading:er,newCount:Q,onRefresh:()=>{if(w.isHelper){let e=_.Z8.find(e=>e.text===w.text);e&&P(e.calcFrom(),F)}ei()},onSearch:eh,defaultSearchValue:C,defaultToValue:F,defaultFromValue:O,queryUrl:"/project/".concat(t,"/logs/explorer?q=").concat(encodeURIComponent(X.sql||""),"&its=").concat(encodeURIComponent(O),"&ite=").concat(encodeURIComponent(F)),onSelectTemplate:e=>{L({...I,search_query:e.searchString})},filters:I,onFiltersChange:L,table:K,condensedLayout:u,isShowingEventChart:j,onToggleEventChart:()=>b(!j),onSelectedDatabaseChange:e=>{L({...I,database:e!==t?e:void 0});let{db:n,...a}=g.query;g.push({pathname:g.pathname,query:e!==t?{...g.query,db:e}:a})},selectedDatePickerValue:w,setSelectedDatePickerValue:N};return(0,a.jsxs)("div",{className:"flex-1 flex flex-col h-full","data-sentry-component":"LogsPreviewer","data-sentry-source-file":"LogsPreviewer.tsx",children:[f?(0,a.jsx)(ej,{...ef}):(0,a.jsx)(A,{...ef}),p,(0,a.jsx)("div",{className:"transition-all duration-500 "+(j&&Z.length>0?"mb-2 mt-1 opacity-100":"h-0 opacity-0"),children:(0,a.jsx)("div",{className:u?"px-3":"",children:j&&(0,a.jsx)(ee,{data:el,onBarClick:e=>{var t;if(!(null==e?void 0:e.timestamp))return;let n=l()(e.timestamp).toISOString(),a=l()(n).subtract(1,"minute").toISOString(),r=l()(n).add(1,"minute").toISOString();eh("event-chart-bar-click",{query:null==(t=I.search_query)?void 0:t.toString(),to:r,from:a})},EmptyState:(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-[67px]",children:[(0,a.jsx)("h2",{className:"text-foreground-light text-xs",children:"No data"}),(0,a.jsx)("p",{className:"text-foreground-lighter text-xs",children:"It may take up to 24 hours for data to refresh"})]})})})}),(0,a.jsxs)("div",{className:"relative flex flex-col flex-grow flex-1 overflow-auto",children:[(0,a.jsx)(D.A,{active:er,"data-sentry-element":"ShimmerLine","data-sentry-source-file":"LogsPreviewer.tsx"}),(0,a.jsx)(E.A,{active:er,"data-sentry-element":"LoadingOpacity","data-sentry-source-file":"LogsPreviewer.tsx",children:(0,a.jsx)(et.A,{projectRef:t,isLoading:er,data:Z,queryType:n,isHistogramShowing:j,onHistogramToggle:()=>b(!j),error:Y,EmptyState:m,onSelectedLogChange:e=>{var t;return W(null!=(t=null==e?void 0:e.id)?t:null)},selectedLog:ec,isSelectedLogLoading:eu,selectedLogError:null!=ed?ed:void 0,"data-sentry-element":"LogTable","data-sentry-source-file":"LogsPreviewer.tsx"})})]}),!Y&&Z.length>0&&(0,a.jsxs)("div",{className:"border-t flex flex-row items-center gap-3 p-2",children:[(0,a.jsx)(k.$,{onClick:es,icon:(0,a.jsx)(o.A,{}),type:"default",loading:eo,disabled:eo,children:"Load older"}),(0,a.jsxs)("div",{className:"text-sm text-foreground-lighter",children:["Showing ",(0,a.jsx)("span",{className:"font-mono",children:Z.length})," results"]}),(0,a.jsx)("div",{className:"flex flex-row justify-end mt-2",children:(0,a.jsx)(en.A,{show:ep,setShowUpgradePrompt:em})})]})]})}}}]);