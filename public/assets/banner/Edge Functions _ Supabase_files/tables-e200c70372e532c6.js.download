!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="35aecb80-0ba7-44f0-bc4d-4408cd3f2613",e._sentryDebugIdIdentifier="sentry-dbid-35aecb80-0ba7-44f0-bc4d-4408cd3f2613")}catch(e){}}(),(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[937,6106],{487:(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/database/tables",function(){return n(90975)}])},19692:(e,t,n)=>{"use strict";n.d(t,{A:()=>l});let l=(0,n(47370).A)("LockOpen",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]])},20829:(e,t,n)=>{"use strict";n.d(t,{A:()=>c});var l=n(80263),o=n(66452),a=n(79319),i=n(63320),r=n.n(i),s=n(16601);let c=e=>{let{title:t="",size:n="medium",children:i,ctaButtonLabel:c="",infoButtonLabel:d="",infoButtonUrl:u="",onClickCta:m=()=>{},loading:f=!1,disabled:h=!1,disabledMessage:p="",ctaUrl:g}=e,y=c&&m||u&&d;return(0,l.jsx)("div",{className:"flex h-full w-full items-center justify-center","data-sentry-component":"ProductEmptyState","data-sentry-source-file":"ProductEmptyState.tsx",children:(0,l.jsx)("div",{className:"flex space-x-4 rounded border bg-surface-100 p-6 shadow-md",children:(0,l.jsx)("div",{className:"flex flex-col",children:(0,l.jsxs)("div",{className:"".concat("medium"===n?"w-80":"w-[400px]"," space-y-4"),children:[(0,l.jsx)("h5",{className:"text-foreground",children:t}),(0,l.jsx)("div",{className:"flex flex-col space-y-2 text-foreground-light",children:i}),y&&(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[c&&g?(0,l.jsx)(s.$,{asChild:!0,type:"primary",children:(0,l.jsx)(r(),{href:g,children:c})}):c&&m?(0,l.jsx)(a.G,{type:"primary",onClick:m,loading:f,disabled:f||h,tooltip:{content:{side:"bottom",text:h&&p.length>0?p:void 0}},children:c}):null,u&&d?(0,l.jsx)(s.$,{type:"default",icon:(0,l.jsx)(o.A,{strokeWidth:1.5}),children:(0,l.jsx)("a",{target:"_blank",rel:"noreferrer",href:u,children:d})}):null]})]})})})})}},26629:(e,t,n)=>{"use strict";n.d(t,{A:()=>l});let l=(0,n(47370).A)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]])},46795:(e,t,n)=>{"use strict";n.d(t,{H:()=>l.A}),n(91824);var l=n(33084)},59168:(e,t,n)=>{"use strict";n.d(t,{p:()=>u});var l=n(80263),o=n(87467),a=n(53239),i=n(2),r=n(49189),s=n(16601),c=n(77690);function d(e){let{icon:t,className:n}=e;return(0,l.jsx)("div",{className:(0,i.cn)("absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-foreground-light",n),"data-sentry-component":"InputIconContainer","data-sentry-source-file":"InputIconContainer.tsx",children:t})}let u=(0,a.forwardRef)((e,t)=>{let{copy:n,showCopyOnHover:u=!1,icon:m,reveal:f=!1,actions:h,onCopy:p,iconContainerClassName:g,containerClassName:y,...x}=e,[b,v]=(0,a.useState)("Copy"),[j,w]=(0,a.useState)(!0),D=(0,c.A)("input"),C=[];return m&&C.push(D.with_icon),(0,l.jsxs)("div",{className:(0,i.cn)("relative group",y),children:[(0,l.jsx)(r.p,{ref:t,...x,onCopy:p,value:f&&j?"**** **** **** ****":x.value,className:(0,i.cn)(...C,x.className)}),m&&(0,l.jsx)(d,{icon:m,className:g}),n||h?(0,l.jsxs)("div",{className:D.actions_container,children:[n&&!(f&&j)?(0,l.jsx)(s.$,{size:"tiny",type:"default",className:(0,i.cn)(u&&"opacity-0 group-hover:opacity-100 transition"),icon:(0,l.jsx)(o.A,{size:16,className:"text-foreground-muted"}),onClick:()=>(function(e){var t;null==(t=navigator.clipboard.writeText(e))||t.then(function(){v("Copied"),setTimeout(function(){v("Copy")},3e3),null==p||p()},function(){v("Failed to copy")})})(x.value),children:b}):null,f&&j?(0,l.jsx)(s.$,{size:"tiny",type:"default",onClick:function(){w(!1)},children:"Reveal"}):null,h&&h]}):null]})})},63236:(e,t,n)=>{"use strict";n.d(t,{A:()=>I});var l=n(80263),o=n(66452),a=n(63320),i=n.n(a),r=n(73969),s=n(38281),c=n(45969),d=n(87120),u=n(32144),m=n(80251),f=n(1438),h=n(77570),p=n(28128),g=n(29127),y=n(30053),x=n(30038);async function b(e){let{projectRef:t,connectionString:n,table:l,filters:o,roleImpersonationState:a}=e,i=(0,p.Nf)(function(e){var t;let{table:n,filters:l}=e,o=new f.Query().from(n.name,null!=(t=n.schema)?t:void 0).delete();return l.filter(e=>e.value&&""!==e.value).forEach(e=>{let t=(0,x.b)(n,e);o=o.filter(e.column,e.operator,t)}),o.toSql()}({table:l,filters:o}),a),{result:r}=await (0,h.E)({projectRef:t,connectionString:n,sql:i,isRoleImpersonationEnabled:(0,g._c)(null==a?void 0:a.role)});return r}let v=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=(0,u.jE)();return(0,m.n)(e=>b(e),{async onSuccess(t,n,o){let{projectRef:a,table:i}=n;await l.invalidateQueries(y.j.tableRowsAndCount(a,i.id)),await (null==e?void 0:e(t,n,o))},async onError(e,n,l){void 0===t?r.oR.error("Failed to delete all table rows: ".concat(e.message)):t(e,n,l)},...n})};var j=n(57947),w=n(67007);async function D(e){let{projectRef:t,connectionString:n,table:l,rows:o,roleImpersonationState:a}=e,i=(0,p.Nf)(function(e){var t;let{table:n,rows:l}=e,{primaryKeys:o,error:a}=(0,x.j)({table:n});if(a)throw a;let i=new f.Query().from(n.name,null!=(t=n.schema)?t:void 0).delete();return null==o||o.forEach(e=>{let t=l.map(t=>t[e]);i=i.filter(e,"in",t)}),i.toSql()}({table:l,rows:o}),a),{result:r}=await (0,h.E)({projectRef:t,connectionString:n,sql:i,isRoleImpersonationEnabled:(0,g._c)(null==a?void 0:a.role)});return r}let C=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=(0,u.jE)();return(0,m.n)(e=>D(e),{async onSuccess(t,n,l){let{projectRef:a,table:i}=n;await o.invalidateQueries(y.j.tableRowsAndCount(a,i.id)),await (null==e?void 0:e(t,n,l))},async onError(e,n,o){if(void 0===t){let{table:t,rows:o}=n,a=e.message.includes("Please add a primary key column"),i=e.message.includes("violates foreign key constraint"),s=o.length>1;if(i){let n=t.name,o=e.message.split("on table ")[2].replaceAll('"',""),a=e.message.split("foreign key constraint")[1].split("on table")[0].replaceAll('"',""),i=s?"Unable to delete rows as one of them is currently referenced by a foreign key constraint from the table `".concat(o,"`."):"Unable to delete row as it is currently referenced by a foreign key constraint from the table `".concat(o,"`."),c="Set an on delete behavior on the foreign key relation `".concat(a,"` in the `").concat(o,"` table to automatically respond when row(s) are being deleted in the `").concat(n,"` table.");(0,r.oR)(i,{description:(0,l.jsx)(j.o,{content:c,className:"[&>p]:m-0"}),action:(0,l.jsx)("div",{className:"w-full flex gap-x-2 !mx-0 mt-3",children:(0,l.jsx)(w.A,{href:"https://supabase.com/docs/guides/database/postgres/cascade-deletes"})})})}else a?(0,r.oR)("Unable to delete row(s) as table has no primary keys",{description:(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm text-foreground-light",children:"Add a primary key column to your table first to serve as a unique identifier for each row before updating or deleting the row."}),(0,l.jsx)("div",{className:"mt-3",children:(0,l.jsx)(w.A,{href:"https://supabase.com/docs/guides/database/tables#primary-keys"})})]})}):r.oR.error("Failed to delete table row: ".concat(e.message))}else t(e,n,o)},...n})};async function S(e){let{projectRef:t,connectionString:n,table:l}=e,o=function(e){var t;let{table:n}=e;return new f.Query().from(n.name,null!=(t=n.schema)?t:void 0).truncate().toSql()}({table:l}),{result:a}=await (0,h.E)({projectRef:t,connectionString:n,sql:o});return a}let N=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=(0,u.jE)();return(0,m.n)(e=>S(e),{async onSuccess(t,n,o){let{projectRef:a,table:i}=n;await l.invalidateQueries(y.j.tableRowsAndCount(a,i.id)),await (null==e?void 0:e(t,n,o))},async onError(e,n,l){void 0===t?r.oR.error("Failed to truncate table row: ".concat(e.message)):t(e,n,l)},...n})};var A=n(53148),k=n(9594),E=n(2411),R=n(98883),T=n(16601),_=n(36212);let I=e=>{var t,n,a,u,m,f,h,p,y;let{selectedTable:x,onTableDeleted:b}=e,{project:j}=(0,c.Om)(),w=(0,k.ap)(),{filters:D,onApplyFilters:S}=(0,s.M)(),I=e=>{let{columnName:t}=e;S(D.filter(e=>e.column!==t))},{mutate:L}=(0,d.T)({onSuccess:()=>{var e;if((null==(e=w.confirmationDialog)?void 0:e.type)!=="column")return;let t=w.confirmationDialog.column;I({columnName:t.name}),r.oR.success('Successfully deleted column "'.concat(t.name,'"'))},onError:e=>{var t;if((null==(t=w.confirmationDialog)?void 0:t.type)!=="column")return;let n=w.confirmationDialog.column;r.oR.error("Failed to delete ".concat(n.name,": ").concat(e.message))},onSettled:()=>{w.closeConfirmationDialog()}}),{mutate:F}=(0,A.A)({onSuccess:async()=>{r.oR.success('Successfully deleted table "'.concat(null==x?void 0:x.name,'"')),null==b||b()},onError:e=>{r.oR.error("Failed to delete ".concat(null==x?void 0:x.name,": ").concat(e.message))},onSettled:()=>{w.closeConfirmationDialog()}}),{mutate:q}=C({onSuccess:()=>{var e,t,n;(null==(e=w.confirmationDialog)?void 0:e.type)==="row"&&(null==(t=(n=w.confirmationDialog).callback)||t.call(n)),r.oR.success("Successfully deleted selected row(s)")},onSettled:()=>{w.closeConfirmationDialog()}}),{mutate:z}=v({onSuccess:()=>{var e,t,n;(null==(e=w.confirmationDialog)?void 0:e.type)==="row"&&(null==(t=(n=w.confirmationDialog).callback)||t.call(n)),r.oR.success("Successfully deleted selected rows")},onError:e=>{r.oR.error("Failed to delete rows: ".concat(e.message))},onSettled:()=>{w.closeConfirmationDialog()}}),{mutate:M}=N({onSuccess:()=>{var e,t,n;(null==(e=w.confirmationDialog)?void 0:e.type)==="row"&&(null==(t=(n=w.confirmationDialog).callback)||t.call(n)),r.oR.success("Successfully deleted all rows from table")},onError:e=>{r.oR.error("Failed to delete rows: ".concat(e.message))},onSettled:()=>{w.closeConfirmationDialog()}}),Q=(null==(t=w.confirmationDialog)?void 0:t.type)==="row"&&w.confirmationDialog.allRowsSelected,P=(null==(n=w.confirmationDialog)?void 0:n.type)==="row"?w.confirmationDialog.allRowsSelected?null!=(y=w.confirmationDialog.numRows)?y:0:w.confirmationDialog.rows.length:0,W=((null==(a=w.confirmationDialog)?void 0:a.type)==="column"||(null==(u=w.confirmationDialog)?void 0:u.type)==="table")&&w.confirmationDialog.isDeleteWithCascade,O=async()=>{var e;if((null==(e=w.confirmationDialog)?void 0:e.type)!=="column"||void 0===j)return;let t=w.confirmationDialog.column;void 0!==t&&L({column:t,cascade:W,projectRef:j.ref,connectionString:null==j?void 0:j.connectionString})},$=async()=>{var e;(null==(e=w.confirmationDialog)?void 0:e.type)==="table"&&void 0!==x&&F({projectRef:null==j?void 0:j.ref,connectionString:null==j?void 0:j.connectionString,id:x.id,name:x.name,schema:x.schema,cascade:W})},H=(0,g.Qj)(),X=async()=>{var e;if(!j)return console.error("Project ref is required");if(!x)return console.error("Selected table required");if((null==(e=w.confirmationDialog)?void 0:e.type)!=="row")return;let t=w.confirmationDialog.rows;if(w.confirmationDialog.allRowsSelected)if(0===D.length){if(void 0!==H().role)return w.closeConfirmationDialog(),r.oR.error("Table truncation is not supported when impersonating a role");M({projectRef:j.ref,connectionString:j.connectionString,table:x})}else z({projectRef:j.ref,connectionString:j.connectionString,table:x,filters:D,roleImpersonationState:H()});else q({projectRef:j.ref,connectionString:j.connectionString,table:x,rows:t,roleImpersonationState:H()})};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(_.A,{variant:"destructive",size:"small",visible:(null==(m=w.confirmationDialog)?void 0:m.type)==="column",title:'Confirm deletion of column "'.concat((null==(f=w.confirmationDialog)?void 0:f.type)==="column"&&w.confirmationDialog.column.name,'"'),confirmLabel:"Delete",confirmLabelLoading:"Deleting",onCancel:()=>{w.closeConfirmationDialog()},onConfirm:O,"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"DeleteConfirmationDialogs.tsx",children:(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("p",{className:"text-sm text-foreground-light",children:"Are you sure you want to delete the selected column? This action cannot be undone."}),(0,l.jsx)(E.A,{label:"Drop column with cascade?",description:"Deletes the column and its dependent objects",checked:W,onChange:()=>w.toggleConfirmationIsWithCascade(),"data-sentry-element":"Checkbox","data-sentry-source-file":"DeleteConfirmationDialogs.tsx"}),W&&(0,l.jsxs)(R.Fc,{variant:"warning",title:"Warning: Dropping with cascade may result in unintended consequences",children:[(0,l.jsx)(R.XL,{children:"All dependent objects will be removed, as will any objects that depend on them, recursively."}),(0,l.jsx)(R.TN,{children:(0,l.jsx)(T.$,{asChild:!0,size:"tiny",type:"default",icon:(0,l.jsx)(o.A,{}),children:(0,l.jsx)(i(),{href:"https://www.postgresql.org/docs/current/ddl-depend.html",target:"_blank",rel:"noreferrer",children:"About dependency tracking"})})})]})]})}),(0,l.jsx)(_.A,{variant:"destructive",size:"small",visible:(null==(h=w.confirmationDialog)?void 0:h.type)==="table",title:(0,l.jsx)("span",{className:"break-words",children:'Confirm deletion of table "'.concat(null==x?void 0:x.name,'"')}),confirmLabel:"Delete",confirmLabelLoading:"Deleting",onCancel:()=>{w.closeConfirmationDialog()},onConfirm:$,"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"DeleteConfirmationDialogs.tsx",children:(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("p",{className:"text-sm text-foreground-light",children:"Are you sure you want to delete the selected table? This action cannot be undone."}),(0,l.jsx)(E.A,{label:"Drop table with cascade?",description:"Deletes the table and its dependent objects",checked:W,onChange:()=>w.toggleConfirmationIsWithCascade(!W),"data-sentry-element":"Checkbox","data-sentry-source-file":"DeleteConfirmationDialogs.tsx"}),W&&(0,l.jsxs)(R.Fc,{variant:"warning",children:[(0,l.jsx)(R.XL,{children:"Warning: Dropping with cascade may result in unintended consequences"}),(0,l.jsx)(R.TN,{children:"All dependent objects will be removed, as will any objects that depend on them, recursively."}),(0,l.jsx)(R.TN,{className:"mt-4",children:(0,l.jsx)(T.$,{asChild:!0,size:"tiny",type:"default",icon:(0,l.jsx)(o.A,{}),children:(0,l.jsx)(i(),{href:"https://www.postgresql.org/docs/current/ddl-depend.html",target:"_blank",rel:"noreferrer",children:"About dependency tracking"})})})]})]})}),(0,l.jsx)(_.A,{variant:"destructive",size:"small",visible:(null==(p=w.confirmationDialog)?void 0:p.type)==="row",title:(0,l.jsxs)("p",{className:"break-words",children:[(0,l.jsx)("span",{children:"Confirm to delete the selected row"}),(0,l.jsx)("span",{children:P>1&&"s"})]}),confirmLabel:"Delete",confirmLabelLoading:"Deleting",onCancel:()=>w.closeConfirmationDialog(),onConfirm:()=>X(),"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"DeleteConfirmationDialogs.tsx",children:(0,l.jsx)("div",{className:"space-y-4",children:(0,l.jsxs)("p",{className:"text-sm text-foreground-light",children:[(0,l.jsx)("span",{children:"Are you sure you want to delete "}),(0,l.jsxs)("span",{children:[Q?"all":"the selected"," "]}),(0,l.jsx)("span",{children:P>1&&"".concat(P," ")}),(0,l.jsx)("span",{children:"row"}),(0,l.jsx)("span",{children:P>1&&"s"}),(0,l.jsx)("span",{children:"? This action cannot be undone."})]})})})]})}},90975:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>y});var l=n(80263),o=n(53239),a=n(89044),i=n(9039),r=n(46795),s=n(63236),c=n(6506),d=n(6408),u=n(95207),m=n(93463),f=n(97195),h=n(9594),p=n(38041);let g=()=>{let{ref:e}=(0,a.g)(),t=(0,h.ap)(),[n,c]=(0,o.useState)();return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(u.eh,{"data-sentry-element":"ScaffoldContainer","data-sentry-source-file":"index.tsx",children:(0,l.jsx)(u.gu,{"data-sentry-element":"ScaffoldSection","data-sentry-source-file":"index.tsx",children:(0,l.jsxs)("div",{className:"col-span-12",children:[(0,l.jsx)(m.M,{title:"Database Tables","data-sentry-element":"FormHeader","data-sentry-source-file":"index.tsx"}),(0,l.jsx)(i.B3,{onAddTable:t.onAddTable,onEditTable:e=>{c((0,f.ID)(e)),t.onEditTable()},onDeleteTable:e=>{c((0,f.ID)(e)),t.onDeleteTable()},onDuplicateTable:e=>{c((0,f.ID)(e)),t.onDuplicateTable()},"data-sentry-element":"TableList","data-sentry-source-file":"index.tsx"})]})})}),void 0!==e&&void 0!==n&&(0,f.KO)(n)&&(0,l.jsx)(p.HQ,{projectRef:e,table:n,children:(0,l.jsx)(s.A,{selectedTable:n})},"table-editor-table-".concat(n.id)),(0,l.jsx)(r.H,{includeColumns:!0,selectedTable:n,"data-sentry-element":"SidePanelEditor","data-sentry-source-file":"index.tsx"})]})};g.getLayout=e=>(0,l.jsx)(d.A,{children:(0,l.jsx)(c.A,{title:"Database",children:e})});let y=g},91824:(e,t,n)=>{"use strict";n.d(t,{A:()=>f});var l=n(80263),o=n(60045),a=n(45969),i=n(20829),r=n(7677),s=n(65904),c=n(89756),d=n(7298),u=n(36365),m=n(9594);let f=e=>{var t,n;let{}=e,f=(0,m.ap)(),{selectedSchema:h}=(0,d.k)(),p=u.i.includes(h),g=(0,s.SE)(o.aG.TENANT_SQL_ADMIN_WRITE,"tables")&&!p,[y]=(0,c.M)("table-editor-sort","alphabetical"),{project:x}=(0,a.Om)(),{data:b}=(0,r.kD)({projectRef:null==x?void 0:x.ref,connectionString:null==x?void 0:x.connectionString,schemas:[h],sort:y}),v=null!=(n=null==b||null==(t=b.pages)?void 0:t[0].data.count)?n:0;return(0,l.jsx)("div",{className:"w-full h-full flex items-center justify-center","data-sentry-component":"EmptyState","data-sentry-source-file":"EmptyState.tsx",children:0===v?(0,l.jsx)(i.A,{title:"Table Editor",ctaButtonLabel:g?"Create a new table":void 0,onClickCta:g?f.onAddTable:void 0,children:(0,l.jsx)("p",{className:"text-sm text-foreground-light",children:"There are no tables available in this schema."})}):(0,l.jsx)("div",{className:"flex flex-col items-center space-y-4",children:(0,l.jsx)(i.A,{title:"Table Editor",ctaButtonLabel:g?"Create a new table":void 0,onClickCta:g?f.onAddTable:void 0,children:(0,l.jsxs)("p",{className:"text-sm text-foreground-light",children:["Select a table from the navigation panel on the left to view its data",g&&", or create a new one."]})})})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[89,4335,2479,8058,9353,9413,3730,6110,6182,589,9257,1673,5599,7990,8508,4365,2981,7406,6554,4560,4963,408,4340,30,2809,3401,2092,5969,3719,9472,9088,3423,1252,7613,8601,3381,7071,5986,9268,6593,636,8792],()=>t(487)),_N_E=e.O()}]);